# 自动负载均衡（Load balance）

## 背景

tablet是tera中管理数据的基本单位，所有的数据存取访问会落在tablet之上，通过预分表、split、merge等操作可以调整tablet所覆盖的数据范围，这样表格的逻辑结构得以确定。

当一个表格被分割为若干tablet之后，每个tablet中包含的数据量不同、承载的数据读写压力也不同。如何将这些tablet合理的分配到tabletnode之上，并且在系统运行过程中动态调整，保证上层服务稳定运行便是“自动负载均衡”需要解决的问题。

## 负载类型

 1. 数据量

  * 关键资源：缓存容量（SSD、内存等）
  * 数据量均衡后可以最大化利用缓存磁盘或内存，使系统服务尽可能多的数据。
  * 经验表明，其它几种负载通常与数据量有很强联系，因此在系统运行中，保持各tabletnode之间数据量均衡是首要目标。 

 1. 随机读
 
  * 关键资源：CPU
  * 读压力均衡可以最大化利用CPU，使系统提供尽可能高的读吞吐。
  * 当读压力很大时，CPU会成为系统首先被用完的资源。
  * 一旦CPU被耗完，系统响应任何请求都会受到较大影响，因此读负载的均衡也非常重要。
 
 1. 顺序扫描

  * 关键资源：CPU、线程池
  * 通常扫描需要返回的数据量更多，单个任务的执行时间较长。当请求很多时，CPU和线程池的负载会显著增长。

 1. 写
 
  * 关键资源：IO（网络、磁盘）
  * 写会产生后台的compact操作（写放大），使系统的IO消耗很高。
  * 万M网卡下，网络IO通常不是瓶颈；下层通过DFS进行磁盘访问，通常单机磁盘不是瓶颈。

几种负载中数据量和读对系统的服务能力有较大影响，tera当前在这两种维度下实现自动负载均衡。

## 实现



